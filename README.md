# Bitrix-timeman
В Битрикс24 уже очень давно существует некая проблема, из-за которой рабочий день сотрудников может не закончиться, хотя они и прожимают кнопку завершения рабочего дня. Отображается оно по-разному, да и ошибки выдаёт разные: иногда ругается на "На этот день уже есть запись", иногда на "Длительность дня не может быть отрицательной". Но, так или иначе, у всех них одинаковый симптом: сильно завышенное значение перерыва.
Судя по симптоматике, Битрикс24 не фиксирует завершение рабочего дня, а переводит статус в "Перерыв". Почему оно так происходит - большая загадка, на данный момент не изученная.

# Костыль
Так или иначе, техподдержка Битрикса предлагает решать данную проблему методом массового завершения рабочего дня через API, для чего и сделан этот код. Функционал простой:
1. В файл "creds" записываешь в первой строке входящий вебхук с правами на использование "Учёт рабочего времени", во второй - вебхук с правами "Пользователи". Никаких дополнительных символов, пробелов, апострофов, тире и так далее не нужно.
2. Запускаешь скрипт в нужный тебе момент.
3. Скрипт сначала собирает список активных сотрудников (не "Онлайн", а именно "Активен"), затем проверяет их статусы: если статус не равен "CLOSED" (то есть установлен статус "OPENED", "PAUSED" или "EXPIRED"), то принудительно его завершает, а запись с ФИ сотрудника и статусом записывает в файл "logs/YYYY-MM-DD.log".

# ToDo
1. Сделать доп.записи для дебага на случай, если что-то сломается. 
